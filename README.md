# Create a Wordpress Site using Terraform:

Create a Wordpress website that does the following:

1. Stores website data - RDS
2. Manage database password securely - Secrets Manager
3. Provision multiple servers in HA mode - Auto Scaling
4. Install WordPress on your servers - User Data Script
5. Distribute requests across multiple web servers - Load Balancer
6. Connect to the website securely via user-friendly DNS names â€“ Route53, ACM

## Wordpress - How To:

### Create and Use DB Password

1. Create DB Password manually using AWS Secrets Manager
2. Pull Password dynamically as a Data Source in Terraform
3. Specify the Secret as the RDS Password

  ( optional - but recommended )

4. Create S3 Remote Backend so that DB Password is not stored as plain text in TF State file

### Output DB Endpoint, DB Name, and DB User Name to use with Wordpress

( optional ) 

Will be used on the EC2 Instance terminal to initiate MySQL and connect it to RDS.

* NOTE:     RDS Endpoint output will include the port number appended to the end
     
  * Do not include the port number in the MySQL command to connect to the database
  
    rds_endpoint Output from Terraform:
    ```
    <RDS Endpoint>:3306
    ```
  
* Not recommeneded to output the AWS Secret - use AWS CLI or AWS console manually to retrieve the value
    ```
    $ aws secretsmanager get-secret-value --secret-id MyTestSecret
    ```

### Specify EC2 Instance AMI

Choose the proper AMI and User Data script in the ASG Module depending on which OS/AMI you prefer:
* Amazon Linux 2023 ( Default in this repo )
* Debian Ubuntu 22.04

A Launch Template resource may be used to implement default choice depending on a Boolean variable.

Will require adjustments of the ASG Module.
```
variable "use_amazonlinux" {
  type        = bool
  description = "Set to true if you want to use Amazon Linux 2023 AMI, false for Debain Ubuntu 22.04 AMI"
  default     = true
}

resource "aws_launch_template" "template" {
  name                   = "${var.project}-Template"
  image_id               = var.use_amazonlinux ? local.amazonlinux2023_ami_id : local.ubuntu_ami_id
  instance_type          = var.instance_type
  vpc_security_group_ids = [module.private_sg.security_group_id]
  user_data              = var.use_amazonlinux ? filebase64(var.amzn2023_user_data) : filebase64(var.ubuntu_user_data)

  update_default_version = true

  instance_initiated_shutdown_behavior = "terminate"

  iam_instance_profile {
    name = aws_iam_instance_profile.ssm_instance_profile.name
  }
}
```

### Connect local MySQL on EC2 terminal to the RDS Instance

From EC2 Terminal:
```
$ mysql -h <RDS Endpoint> -u <DB User Name> -p
```
* Enter password when prompted ( password from AWS Secrets Manager )

### Verify Wordpress RDS database is Operational and Connected

After connecting to MySQL using the command above, perform the following commands:
1. List all databases to ensure "Wordpress" database is in the returned list
```
mysql$ SHOW databases;
```
2. Use Wordpress database
```
mysql$ USE wordpress;
```

If the following commands return results, the Wordpress RDS database is connected.

### Setup Wordpress server using the RDS Credentials

Wordpress comes with a built-in Admin page to modify the website. 

If the EC2 Instance is functioning properly, connecting to your DNS Host will route to the WP Admin page.

You will have to make sure your Route53 Hosted Zone or other DNS service is properly configured.

Follow Wordpress instructions to intiate Wordpress account and site:
  1. Use Credentials from RDS Module:

    - DB Name
    - DB User
    - DB Password

  2. Click the button to Run Installation

  3. Create a Wordpress Account
     
    - Wordpress Site Name/Header
    - Wordpress User Name
    - Wordpress Account Password
    - Email Address

  4. Sign in to Wordpress using Credentials
     
    This will direct you to the Wordpress Admin page.
    You can now begin customizing your own Wordpress webpage.

### Confirm RDS is Saving your Wordpress Site Data

If the RDS instance is connected, you can view the Tables and information generated by Wordpress and saved to RDS.

Follow the instructions from ```Connect local MySQL on EC2 terminal to the RDS Instance``` to login to MySQL via the EC2 terminal.

Query Tables or specific information from RDS:
```
mysql$ SHOW Tables;
```
```
mysql$ SELECT * FROM wp_users;
```
